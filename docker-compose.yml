
services:
  wiki:
    build:
      context: .
      dockerfile: ./docker/debian/Dockerfile
    image: fswiki-wiki-server:latest
    hostname: fswiki-wiki-server
    volumes:
      - .:/app
    ports:
      - "5001:8080"
    networks:
      farad_net:
        ipv4_address: 10.33.1.1
    environment:
      - TZ=Asia/Tokyo
      - ROOT_PASSWORD=fswiki2021
      - PERL5LIB=/app/local/lib/perl5
      - PATH=/app/local/bin:$PATH
      - DB_DRIVER=mysql
      - DB_HOST=mysql
      - DB_NAME=fswiki
      - DB_USER=root
      - DB_PASS=password
    working_dir: /app
    command: carton exec plackup -p 8080 --listen 0.0.0.0 app.psgi
    depends_on:
      - mysql
  mysql:
    image: mysql:8.0
    platform: linux/amd64
    hostname: fswiki-db-server
    volumes:
      - mysql-data:/var/lib/mysql
    ports:
      - "3306:3306"
    networks:
      farad_net:
        ipv4_address: 10.33.1.2
    environment:
      - TZ=Asia/Tokyo
      - MYSQL_ROOT_PASSWORD=password
      - MYSQL_DATABASE=fswiki

volumes:
  run:
  mysql-data:

networks:
  farad_net:
    driver: bridge
    enable_ipv6: false
    ipam:
      driver: default
      config:
        - subnet: 10.33.0.0/21
          gateway: 10.33.0.1
