# **Product Context**

## **プロジェクトの目的**

FreestyleWiki Cloudflare Workers Migrationプロジェクトは、従来のサーバーベースのWikiシステム、特にPerlで実装されたFreestyleWikiを、Cloudflareのサーバーレスプラットフォーム上で動作させることを目的としています。これにより、運用・管理の手間を削減し、高いスケーラビリティとパフォーマンス、そしてコスト効率を実現します。

## **解決する問題**

* 従来のサーバーベースWikiのホスティングコストと運用負荷の高さ。  
* Perl実行環境の維持・管理の複雑さ。  
* アクセス増加に伴うスケーリングの課題。  
* セキュリティパッチ適用などのメンテナンス負担。

## **動作方法**

移植されたWikiは、主にCloudflare Workers上で動作します。

1. **リクエスト受付:** ユーザーからのWikiページ表示、編集、保存などのリクエストはCloudflare Workersが受け付けます。  
2. **ルーティング:** WorkersはリクエストURLに基づいて適切な処理ハンドラにルーティングします (例: /wiki/タイトル なら表示処理、/wiki/タイトル/edit なら編集フォーム表示)。  
3. **データアクセス:**  
   * ページの表示リクエストでは、まずCloudflare KVから最新のページ本文キャッシュを試みます。キャッシュがなければ、Cloudflare D1 (SQLite互換DB) からページ本文とリビジョン履歴を取得します。  
   * ページの保存リクエストでは、編集内容を検証し、新しいリビジョンとしてD1に保存します。同時に、KVのキャッシュを更新または無効化します。  
   * 添付ファイルはCloudflare R2に保存され、D1にはそのメタ情報が記録されます。  
4. **ロジック処理:** Workers上でJavaScript/TypeScriptで実装されたFreestyleWikiのコアロジック（テキスト整形、差分計算、履歴管理など）が実行されます。このロジックの実装には、元のPerlコードをClineを用いて変換したコードが活用されます。  
5. **レスポンス生成:** 処理結果に基づいて、WorkersがHTMLコンテンツやAPIレスポンスを生成し、ユーザーに返します。

**Clineの役割:** Clineは、この「ロジック処理」部分において、元のPerlコードをJavaScript/TypeScriptに自動または半自動で変換するための**ツール**として使用されます。変換されたコードはWorkers上で実行される最終的なシステムの一部となります。

## 概要

FreestyleWiki Cloudflare Workers移植版は、Cloudflare Workers上で動作するTypeScriptによるWikiシステムです。主な特徴は以下の通りです。

* **サーバーレスアーキテクチャ**: Cloudflare Workers上で動作するため、サーバー管理が不要で高いスケーラビリティと可用性を持ちます。
* **TypeScriptによる実装**: 型安全性を持ち、モダンな開発手法で拡張・保守が容易です。
* **Cloudflareサービスとの連携**: D1 (SQLite), KV, R2を活用し、高いパフォーマンスと耐久性のあるデータ永続化を実現します。
* **拡張可能な設計**: 元のFreestyleWikiのモジュール性を引き継ぎ、プラグインによる機能拡張が可能です。
* **日本語対応**: 日本語でのドキュメント作成に適した文法と機能をサポートします。
* **主要機能の移植**: ヘッダ、フッタ、サイドバー、添付ファイル、PDF生成（検討中）、テーマ、サイトテンプレート、ページ凍結、ユーザー認証などの主要機能を移植します。
