# **Product Context**

## **プロジェクトの目的**

FreestyleWiki Cloudflare Workers Migrationプロジェクトは、従来のサーバーベースのWikiシステム、特にPerlで実装されたFreestyleWikiを、Cloudflareのサーバーレスプラットフォーム上で動作させることを目的としています。これにより、運用・管理の手間を削減し、高いスケーラビリティとパフォーマンス、そしてコスト効率を実現します。

## **解決する問題**

* 従来のサーバーベースWikiのホスティングコストと運用負荷の高さ。  
* Perl実行環境の維持・管理の複雑さ。  
* アクセス増加に伴うスケーリングの課題。  
* セキュリティパッチ適用などのメンテナンス負担。

## **動作方法**

移植されたWikiは、主にCloudflare Workers上で動作します。

1. **リクエスト受付:** ユーザーからのWikiページ表示、編集、保存などのリクエストはCloudflare Workersが受け付けます。  
2. **ルーティング:** WorkersはリクエストURLに基づいて適切な処理ハンドラにルーティングします (例: /wiki/タイトル なら表示処理、/wiki/タイトル/edit なら編集フォーム表示)。  
3. **データアクセス:**  
   * ページの表示リクエストでは、まずCloudflare KVから最新のページ本文キャッシュを試みます。キャッシュがなければ、Cloudflare D1 (SQLite互換DB) からページ本文とリビジョン履歴を取得します。  
   * ページの保存リクエストでは、編集内容を検証し、新しいリビジョンとしてD1に保存します。同時に、KVのキャッシュを更新または無効化します。  
   * 添付ファイルはCloudflare R2に保存され、D1にはそのメタ情報が記録されます。  
4. **ロジック処理:** Workers上でJavaScript/TypeScriptで実装されたFreestyleWikiのコアロジック（テキスト整形、差分計算、履歴管理など）が実行されます。このロジックの実装には、元のPerlコードをClineを用いて変換したコードが活用されます。  
5. **レスポンス生成:** 処理結果に基づいて、WorkersがHTMLコンテンツやAPIレスポンスを生成し、ユーザーに返します。

**Clineの役割:** Clineは、この「ロジック処理」部分において、元のPerlコードをJavaScript/TypeScriptに自動または半自動で変換するための**ツール**として使用されます。変換されたコードはWorkers上で実行される最終的なシステムの一部となります。

## 概要

FreeStyle WikiはPerlによる拡張可能なWikiクローンです。FreeStyle Wikiは以下のような特徴を持っています。

* 徹底的にモジュール化されており、拡張性が高い
* PurePerlで実装されておりDBを使用しないため、多くのレンタルサーバに設置可能
* 日本語でのドキュメント作成に適した文法と機能
* 全ページ共通のヘッダ、フッタ、サイドバーを表示可能
* ファイルの添付が可能
* PDFの生成が可能
* tDiaryのテーマを使用可能
* サイトテンプレート機能によりデザインを大幅に変更することが可能
* ページの凍結機能に加え、簡単なユーザ認証機能を備えている
* mod_perlでも（一応）動作可能
