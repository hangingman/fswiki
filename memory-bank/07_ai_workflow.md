## AIエージェント向け開発指示書

### 開発ワークフロー

このセクションでは、AIとの協業を最適化し、コード品質と開発速度を向上させるための開発ワークフローを定義します。このワークフローでは、品質と予測可能性を最大化するため、**原則として常にテスト駆動開発（TDD）を基本とします。**

#### TDDを基本とする開発ワークフロー

探索から実装、コミットまでを一貫したフローとして定義します。特に実装フェーズはTDDのサイクル（Red-Green-Refactor）に従って進めます。

#### TDDが特に重要な理由

* **明確なゴール設定:** テストが存在することで、「このテストが通ればOK」という明確なゴールが与えられます。これにより、迷うことなく、過剰な実装を避けることができます。
* **過剰な実装の防止:** テストがない場合、親切心から不要な機能まで実装してしまう可能性があります。テストは作業範囲を明確に制限します。
* **漸進的な開発:** 小さなサイクルを繰り返すことで、複雑なタスクを管理可能なステップに分割し、安全かつ着実に開発を進めることができます。

```mermaid
graph TD
    Start[ユーザーからのタスク指示] --> A[探索フェーズ];
    A --> B[計画フェーズ];
    B --> C[TDDによる実装フェーズ];
    C --> D[コミット・PR作成フェーズ];

    subgraph 探索フェーズ
        direction LR
        A1[タスクの理解] --> A2[関連ファイルの読み込み];
        A2 --> A3[コード・依存関係・影響範囲の調査];
        A3 --> A4[共通パターンや既存ロジックの分析];
    end

    subgraph 計画フェーズ
        direction LR
        B1[ツールによる情報収集] --> B2[テストケースの洗い出し];
        B2 --> B3[実装方針と手順の立案];
        B3 --> B4[計画の文書化とユーザーへの承認要求];
    end

    subgraph TDDによる実装フェーズ
        C1[RED: 失敗するテストの作成];
        C2[GREEN: テストをパスする最小限のコードを実装];
        C3[REFACTOR: テストを維持したままコードを改善];
        C1 --> C2;
        C2 --> C3;
        C3 -- 次のテスト/改善があれば --> C1;
        C3 -- 実装完了 --> D;
    end

    subgraph コミット・PR作成フェーズ
        direction LR
        D1[論理的な単位でのコミット分割] --> D2[Conventional Commits規約準拠のメッセージ作成];
        D2 --> D3[PR説明の記述];
        D3 --> D4[関連ドキュメントの更新];
        D4 -- コミット・プッシュ前に --> D5[make testの実行];
    end
```
