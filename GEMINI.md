# GEMINI.md: AI支援開発ガイドライン

このドキュメントは、GeminiなどのAIを活用してこのプロジェクトの開発を進める上でのルールと規約を定めたものです。

## プロジェクト概要

このプロジェクトは、Wikiアプリケーション「FSWiki」です。Perlを使用して開発されています。

## 技術スタック

*   **バックエンド:** Perl
*   **Webサーバー/アプリケーションサーバー:** Starman, Plack
*   **データベース:** MySQL (DBD::mysqlPP)
*   **フロントエンド:** HTML::Template (特定のJSフレームワークはTBD)
*   **ビルド/実行環境:** Docker, Docker Compose

## 開発環境のセットアップ

### 前提条件

*   Docker
*   Docker Compose

### セットアップ手順

1.  **依存関係のビルドとアプリケーションの起動:**
    ```bash
    make run
    ```
    これにより、Dockerコンテナがビルドされ、アプリケーションがバックグラウンドで起動します。

## ビルドとテスト

*   **ビルド:**
    ```bash
    make build
    ```
*   **テスト:**
    *   テストの実行方法は現在ドキュメント化されていません (TBD)。

## AIコーディングの基本方針

*   **既存の規約を尊重する:** 常に既存のコードのスタイル、フォーマット、命名規則を最優先してください。コードを生成・修正する前に、周辺のコードをよく分析すること。
*   **ライブラリの利用:** 新しいライブラリの追加を検討する場合は、必ず `cpanfile` を確認し、プロジェクトにとって適切かどうかを判断してください。安易に新しい依存関係を導入しないこと。
*   **テストの実施:** 新機能の追加やバグ修正を行う際には、対応するテストコードも追加・更新し、コードの品質を担保すること。
*   **Perl:**
    *   コーディング規約は現在ドキュメント化されていません (TBD)。
*   **プルリクエスト:**
    *   プルリクエストのタイトルと本文は日本語で記述してください。

## Gitブランチ運用ルール

*   **`master`**: 本番リリース用のブランチです。このブランチへの直接のコミットは固く禁止します。マージは `develop` ブランチからのみ、十分なテストを経て行います。
*   **`develop`**: 開発のメインとなるブランチです。すべての作業ブランチは `develop` から作成し、作業完了後は `develop` へマージします。
*   **`issues/<issue-id>_<description>`**: 機能開発やバグ修正など、すべての作業はこの命名規則のブランチで行います。
    *   `<issue-id>`: 対応する課題管理システムのID。
    *   `<description>`: `add-user-auth` のように、作業内容を簡潔に英語で記述します。

## コミットメッセージの規約

*   Conventional Commits の規約に従ってください。
    *   `feat: <新機能の概要>`
    *   `fix: <バグ修正の概要>`
    *   `docs: <ドキュメントの変更>`
    *   `style: <コードスタイルの修正（フォーマットなど）>`
    *   `refactor: <機能的な変更を伴わないリファクタリング>`
    *   `test: <テストの追加・修正>`
    *   `chore: <ビルドプロセスや補助ツールの変更など>`
*   複数行のコミットメッセージを作成する際は、一時ファイルにメッセージを書き込み、`git commit -F <一時ファイルへの絶対パス>` を使用してください。これにより、シェルの解釈による問題を回避し、確実に複数行のメッセージをコミットできます。一時ファイルはコミット後に削除してください。

## AIエージェント向け開発指示書

### 開発ワークフロー

このセクションでは、AIとの協業を最適化し、コード品質と開発速度を向上させるための開発ワークフローを定義します。このワークフローでは、品質と予測可能性を最大化するため、**原則として常にテスト駆動開発（TDD）を基本とします。**

#### TDDを基本とする開発ワークフロー

探索から実装、コミットまでを一貫したフローとして定義します。特に実装フェーズはTDDのサイクル（Red-Green-Refactor）に従って進めます。

#### TDDが特に重要な理由

* **明確なゴール設定:** テストが存在することで、「このテストが通ればOK」という明確なゴールが与えられます。これにより、迷うことなく、過剰な実装を避けることができます。
* **過剰な実装の防止:** テストがない場合、親切心から不要な機能まで実装してしまう可能性があります。テストは作業範囲を明確に制限します。
* **漸進的な開発:** 小さなサイクルを繰り返すことで、複雑なタスクを管理可能なステップに分割し、安全かつ着実に開発を進めることができます。

```mermaid
graph TD
    Start[ユーザーからのタスク指示] --> A[探索フェーズ];
    A --> B[計画フェーズ];
    B --> C[TDDによる実装フェーズ];
    C --> D[コミット・PR作成フェーズ];

    subgraph 探索フェーズ
        direction LR
        A1[タスクの理解] --> A2[関連ファイルの読み込み];
        A2 --> A3[コード・依存関係・影響範囲の調査];
        A3 --> A4[共通パターンや既存ロジックの分析];
    end

    subgraph 計画フェーズ
        direction LR
        B1[ツールによる情報収集] --> B2[テストケースの洗い出し];
        B2 --> B3[実装方針と手順の立案];
        B3 --> B4[計画の文書化とユーザーへの承認要求];
    end

    subgraph TDDによる実装フェーズ
        C1[RED: 失敗するテストの作成];
        C2[GREEN: テストをパスする最小限のコードを実装];
        C3[REFACTOR: テストを維持したままコードを改善];
        C1 --> C2;
        C2 --> C3;
        C3 -- 次のテスト/改善があれば --> C1;
        C3 -- 実装完了 --> D;
    end

    subgraph コミット・PR作成フェーズ
        direction LR
        D1[論理的な単位でのコミット分割] --> D2[Conventional Commits規約準拠のメッセージ作成];
        D2 --> D3[PR説明の記述];
        D3 --> D4[関連ドキュメントの更新];
        D4 -- コミット・プッシュ前に --> D5[make testの実行];
    end
```

## 会話ガイドライン

*   常に日本語で会話してください。
*   Web検索を行う際は、`ddg-search` と `readability` ツールを優先的に使用してください。これは、よりプライバシーを重視し、追跡を減らすためです。
*   GitHubの情報を取得する際は、`github mcp` ツールを優先的に使用してください。これは、GitHub APIを直接利用することで、より正確で構造化された情報を効率的に取得できるためです。

## その他

*   新しい機能を追加する際は、既存のコードの構造とパターンを参考にしてください。
*   不明な点があれば、プロジェクト内のドキュメントを参照してください (TBD)。

---
*このドキュメントはAIによって管理されており、チームの合意に基づいて更新されることがあります。*
