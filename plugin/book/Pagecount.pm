################################################################################
#
# <p>現在表示しているページの概算ページ数を表示するインラインプラグインです。</p>
# <p>1ページ=1600文字で計算しています。</p>
# <pre>
# 文字数：{{pagecount}}
# </pre>
# <p>引数でカウント対象のページを指定することもできます。</p>
# <pre>
# 文字数：{{pagecount ページ名}}
# </pre>
#
################################################################################
package plugin::book::Pagecount;
use strict;
use warnings;
use Encode qw(decode);
#==============================================================================
# コンストラクタ
#==============================================================================
sub new {
	my $class = shift;
	my $self = {};
	return bless $self,$class;
}

#==============================================================================
# インラインメソッド
#==============================================================================
sub inline {
	my $self = shift;
	my Wiki $wiki = shift;
	my $page = shift;

	$page = $wiki->get_CGI->param('page') unless $page;
	my $source = $wiki->get_page($page);

	return int(length(decode('utf-8', $source)) / 1600 + 1);
}

1;
